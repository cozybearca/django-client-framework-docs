

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>The design decision for API type-safety &mdash; Django Client Framework  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Django Client Framework
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction to the Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html#an-overview-of-the-framework">An Overview of the Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html#getting-started-with-the-backend">Getting Started with the Backend</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#installation-with-pip3-git">Installation with pip3+git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#configure-django-s-settings-py-file">Configure Django’s settings.py file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#add-routing-handlers-to-urls-py">Add routing handlers to <code class="docutils literal notranslate"><span class="pre">urls.py</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#add-a-serializable-model">Add a Serializable model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#make-an-accesscontrolled-model">Make an AccessControlled model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#query-objects-via-http-requests">Query objects via HTTP requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#query-relational-objects-via-http">Query relational objects via HTTP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html#getting-starting-with-client-libraries">Getting Starting with Client Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#install-client-libraries">Install client libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../intro/index.html#typescript">TypeScript</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intro/index.html#swift">Swift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intro/index.html#kotlin">Kotlin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#define-a-model-class">Define a model class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#retrieve-a-model-object">Retrieve a model object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro/index.html#retrieve-a-relational-object">Retrieve a relational object</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../backend-refs/index.html">Backend API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../backend-refs/index.html#models-module">models module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../backend-refs/index.html#serializable">Serializable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../backend-refs/index.html#inheritance">Inheritance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../backend-refs/index.html#serializer-class-cls">.serializer_class(cls)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../backend-refs/index.html#serializer">.serializer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../backend-refs/index.html#get-serialization-cache-timeout">.get_serialization_cache_timeout()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../backend-refs/index.html#api-module">api module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../backend-refs/index.html#urls-py">urls.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../backend-refs/index.html#serializers-module">serializers module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../backend-refs/index.html#id1">Serializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backend-refs/index.html#modelserializer">ModelSerializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backend-refs/index.html#delegateserializer">DelegateSerializer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Client Libraries Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#model">Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#inheritance">Inheritance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#collectionmanager-t">CollectionManager&lt;T&gt;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#constructor">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#page-query-pagination">.page(query, pagination)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-query">.get(query)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#create-data">.create(data)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-or-create-query-defaults">.get_or_create(query, defaults)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#update-or-create-query-defaults">.update_or_create(query, defaults)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#objectmanager-t">ObjectManager&lt;T&gt;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id2">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#refresh">.refresh()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#save">.save()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#update-data">.update(data)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#delete">.delete()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#relatedcollectionmanager-t-p">RelatedCollectionManager&lt;T, P&gt;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#relatedcollectionmanager-page">.page(query, pagination)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-query-pagination">.get(query, pagination)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#add-ids-ids">.add_ids(ids)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#set-ids-ids">.set_ids(ids)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#remove-ids-ids">.remove_ids(ids)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#add-objs">.add(objs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#set-objs">.set(objs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#remove-objs">.remove(objs)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#relatedobjectmanager-t-p">RelatedObjectManager&lt;T, P&gt;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id5">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get">.get()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#set-target">.set(target?)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-design-decision-for-api-type-safety">The design decision for API type-safety</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modify-this-document.html">Modify this documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Django Client Framework</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>The design decision for API type-safety</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/client-refs/the-design-decision-for-type-safety.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-design-decision-for-api-type-safety">
<h1>The design decision for API type-safety<a class="headerlink" href="#the-design-decision-for-api-type-safety" title="Permalink to this headline">¶</a></h1>
<p>The goal of the client libraries is to provide type safety to gard against typos
that could be made on model properties, at the same type, utilize Django’s
flexible QuerySet API. We would also like to keep a consistent API interface
across all supported programming languages, so that the learning curve can be
flat. Finally, we would like the client’s model code to be automatically
generated according to the backend code.</p>
<p>There are some difficulties when designing such API. For instance, we can only
use features that are present in all supported programming languages. Advance
features such as the <code class="docutils literal notranslate"><span class="pre">Partial&lt;T&gt;</span></code> type in <cite>TypeScript</cite>, or <cite>associated types</cite>
in <cite>Swift</cite> cannot be used, because they don’t exist in other languages, and the
API would be inconsistent.</p>
<p>We want to prevent typos made when querying and updating objects. The current
API provides limited guarantees. For instance, when modifying model properties
and call <a href="#id1"><span class="problematic" id="id2">`ObjectManager.save()`_</span></a>, typos are prevented because the programming
language only allows access on defined properties.</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">product</span>: <span class="kt">ObjectManager</span><span class="o">&lt;</span><span class="nx">Product</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">...</span>
<span class="nx">product</span><span class="p">.</span><span class="nx">barcode</span> <span class="o">=</span> <span class="s2">&quot;xxyy&quot;</span>
<span class="nx">product</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
</pre></div>
</div>
<p>How can we make APIs such as <a href="#id3"><span class="problematic" id="id4">`ObjectManager.update(...)`_</span></a> or
<a href="#id5"><span class="problematic" id="id6">`CollectionManager.page(...)`_</span></a> type safe? There are two types of difficulties we
must take into consideration. First, you need to realize that the backend modal
API such as <code class="docutils literal notranslate"><span class="pre">PATCH</span> <span class="pre">/product/1</span></code> does not only accept valid properties that are
defined on the model. In fact, the backend could use <a href="#id7"><span class="problematic" id="id8">`DelegatedSerializer`_</span></a> to
accept a variaty of key-value pairs. For instance, if a <cite>User</cite> model API is
designed to change user password, the backend will expect an request such as:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>// PATCH /user/1

{
    old_password: &quot;1234&quot;,
    new_password: &quot;xxyy&quot;,
}
</pre></div>
</div>
<p>The backend can achieve this with the <a href="#id9"><span class="problematic" id="id10">`DelegatedSerializer`_</span></a> class. However,
neither <cite>old_password</cite> and <cite>new_password</cite> are keys on the <cite>User</cite> model.</p>
<p>To resolve this issue, we can consider making the <a href="#id11"><span class="problematic" id="id12">`ObjectManager.update(...)`_</span></a> a
generic method such as:</p>
<div class="highlight-TypeScript notranslate"><div class="highlight"><pre><span></span><span class="nx">update</span><span class="o">&lt;</span><span class="nx">X</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">data</span>: <span class="kt">X</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where X is any type that is serializable. This way we have define a separate interface such as</p>
<div class="highlight-TypeScript notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nx">UserUpdatePassword</span> <span class="p">{</span>
    <span class="nx">old_password</span>: <span class="kt">string</span>
    <span class="nx">new_password</span>: <span class="kt">string</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then when calling the <a href="#id13"><span class="problematic" id="id14">`ObjectManager.update(...)`_</span></a> method you can specify the <code class="docutils literal notranslate"><span class="pre">X</span></code>:</p>
<div class="highlight-TypeScript notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">update</span><span class="o">&lt;</span><span class="nx">UserUpdatePassword</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</pre></div>
</div>
<p>[to be continued]</p>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Yu.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>